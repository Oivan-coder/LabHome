import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns

# Установка стиля графиков
sns.set(style="whitegrid")

# Данные по категориям услуг
data = {
    "Категория": ["Категория 1", "Категория 1", "Категория 1", "Категория 1", "Категория 1",
                  "Категория 2", "Категория 2", "Категория 2",
                  "Категория 3", "Категория 3", "Категория 3",
                  "Категория 4", "Категория 4"],
    "Код": ["P176", "P783", "P745", "P649", "P741",
            "P428", "P780", "P352",
            "P179", "P357", "D005",
            "P042", "P050"],
    "Кол-во": [19, 15, 2, 10, 15, 8, 5, 1, 3154, 3857, 626, 736, 813],
    "Выручка": [119499.5, 41656.0, 3500.0, 39018.6, 72589.55,
                2179.0, 1809.07, 750.0,
                4696261.36, 5903273.22, 1352682.44,
                172725.40, 163275.55],
    "Себестоимость": [5909.09, 2733.13, 1294.51, 1798.9, 2061.56,
                      278.71, 259.02, 555.1,
                      1158.13, 1156.95, 1082.18,
                      125.77, 111.04]
}

df = pd.DataFrame(data)
df["Маржинальность"] = ((df["Выручка"] - df["Себестоимость"] * df["Кол-во"]) / df["Выручка"]) * 100

# Создание графиков
fig, axes = plt.subplots(3, 1, figsize=(14, 18))

# 1. Объем продаж по категориям
sns.barplot(data=df, x="Категория", y="Кол-во", estimator=sum, ci=None, ax=axes[0], palette="viridis")
axes[0].set_title("Объем продаж по категориям", fontsize=14)
axes[0].set_ylabel("Количество исследований")
axes[0].set_xlabel("")

# 2. Средняя маржинальность по категориям
avg_margin = df.groupby("Категория")["Маржинальность"].mean().reset_index()
sns.barplot(data=avg_margin, x="Категория", y="Маржинальность", ax=axes[1], palette="coolwarm")
axes[1].set_title("Средняя маржинальность по категориям", fontsize=14)
axes[1].set_ylabel("Маржинальность (%)")
axes[1].set_xlabel("")

# 3. Выручка по услугам
sorted_df = df.sort_values("Выручка", ascending=False)
sns.barplot(data=sorted_df, x="Код", y="Выручка", hue="Категория", dodge=False, ax=axes[2], palette="Set2")
axes[2].set_title("Выручка по услугам", fontsize=14)
axes[2].set_ylabel("Выручка (руб)")
axes[2].set_xlabel("Код услуги")
axes[2].legend(title="Категория")

plt.tight_layout()
plt.show()
